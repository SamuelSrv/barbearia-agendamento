<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barbearia Classic Cuts - Agendamento Online</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #121212; /* Fundo principal mais escuro */
        }
        .font-brand {
            font-family: 'Playfair Display', serif;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .loader {
            border: 4px solid #444;
            border-top: 4px solid #f97316; /* Laranja */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .hero-section {
            background-image: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('https://images.unsplash.com/photo-1621607512214-6c34117fe57b?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
        }
        /* Estilos para a animação de scroll */
        .scroll-animate {
            opacity: 0;
            transform: translateY(40px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }
        .scroll-animate.is-visible {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body class="text-gray-200">

    <!-- Header -->
    <header class="bg-zinc-900 bg-opacity-80 backdrop-blur-sm shadow-lg sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="text-2xl font-brand text-orange-500" onclick="app.router.showPage('home')">Classic Cuts</a>
            <div class="hidden md:flex space-x-8 items-center">
                <a href="#" class="hover:text-orange-500 transition-colors" onclick="app.router.showPage('home')">Home</a>
                <a href="#" class="hover:text-orange-500 transition-colors" onclick="app.router.showPage('barbers')">Barbeiros</a>
                <a href="#" class="bg-orange-600 text-white font-bold py-2 px-5 rounded-lg hover:bg-orange-700 transition-colors" onclick="app.router.showPage('schedule')">Agendar Horário</a>
                <a href="#" id="login-nav-link" class="hover:text-orange-500 transition-colors" onclick="app.router.showPage('login')">Admin</a>
                <a href="#" id="admin-nav-link" class="hover:text-orange-500 transition-colors hidden" onclick="app.router.showPage('admin')">Painel</a>
                <a href="#" id="logout-nav-link" class="hover:text-red-500 transition-colors hidden" onclick="app.authHandler.logout()">Sair</a>
            </div>
             <!-- Mobile Menu Button -->
            <div class="md:hidden">
                <button onclick="document.getElementById('mobile-menu').classList.toggle('hidden')" class="text-white focus:outline-none">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </nav>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-zinc-900">
            <a href="#" class="block py-2 px-4 text-sm hover:bg-zinc-800" onclick="app.router.showPage('home'); document.getElementById('mobile-menu').classList.add('hidden')">Home</a>
            <a href="#" class="block py-2 px-4 text-sm hover:bg-zinc-800" onclick="app.router.showPage('barbers'); document.getElementById('mobile-menu').classList.add('hidden')">Barbeiros</a>
            <a href="#" class="block py-2 px-4 text-sm hover:bg-zinc-800" onclick="app.router.showPage('schedule'); document.getElementById('mobile-menu').classList.add('hidden')">Agendar</a>
            <a href="#" id="login-nav-link-mobile" class="block py-2 px-4 text-sm hover:bg-zinc-800" onclick="app.router.showPage('login'); document.getElementById('mobile-menu').classList.add('hidden')">Admin</a>
            <a href="#" id="admin-nav-link-mobile" class="hidden block py-2 px-4 text-sm hover:bg-zinc-800" onclick="app.router.showPage('admin'); document.getElementById('mobile-menu').classList.add('hidden')">Painel</a>
            <a href="#" id="logout-nav-link-mobile" class="hidden block py-2 px-4 text-sm hover:bg-zinc-800" onclick="app.authHandler.logout(); document.getElementById('mobile-menu').classList.add('hidden')">Sair</a>
        </div>
    </header>

    <main>
        <!-- Página Home -->
        <div id="home" class="page active">
            <!-- Hero Section -->
            <section class="hero-section text-white text-center py-32 px-6">
                <h1 class="text-5xl md:text-6xl font-brand mb-4 scroll-animate">Barbearia Moderna no Coração da Cidade</h1>
                <p class="text-lg text-gray-300 max-w-2xl mx-auto mb-8 scroll-animate" style="transition-delay: 150ms;">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                <button class="bg-orange-600 text-white font-bold py-3 px-8 rounded-lg text-xl hover:bg-orange-700 transition duration-300 scroll-animate" style="transition-delay: 300ms;" onclick="app.router.showPage('schedule')">
                    Agendar Horário
                </button>
            </section>
            
            <!-- Services Section -->
            <section class="container mx-auto px-6 py-20">
                <div class="scroll-animate">
                    <h2 class="text-4xl font-brand text-center mb-12">Nossos Serviços</h2>
                    <div class="grid md:grid-cols-3 gap-8">
                        <div class="bg-zinc-800 p-8 rounded-lg text-center border border-zinc-700">
                            <h3 class="text-2xl font-bold text-orange-500 mb-2">Barba Alinhada</h3>
                            <p class="text-gray-400">Modelagem de barba com toalha quente, navalha e os melhores produtos do mercado.</p>
                        </div>
                        <div class="bg-zinc-800 p-8 rounded-lg text-center border border-zinc-700">
                             <h3 class="text-2xl font-bold text-orange-500 mb-2">Cortes de Cabelo</h3>
                             <p class="text-gray-400">Do clássico ao moderno, nossos barbeiros dominam todos os estilos para um visual impecável.</p>
                        </div>
                        <div class="bg-zinc-800 p-8 rounded-lg text-center border border-zinc-700">
                             <h3 class="text-2xl font-bold text-orange-500 mb-2">Tratamento Completo</h3>
                             <p class="text-gray-400">Uma experiência completa que inclui corte, barba e tratamento facial para renovar seu estilo.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Pricing Section -->
            <section class="bg-zinc-900 py-20">
                <div class="container mx-auto px-6 scroll-animate">
                    <h2 class="text-4xl font-brand text-center mb-12">Nossos Preços</h2>
                    <div class="max-w-4xl mx-auto">
                        <div class="grid md:grid-cols-2 gap-x-12 gap-y-8">
                            <!-- Price Item -->
                            <div class="flex items-center space-x-4">
                                <img src="https://images.unsplash.com/photo-1622288399343-22524a87b6a4?q=80&w=1325&auto=format&fit=crop" class="w-16 h-16 rounded-full object-cover border-2 border-zinc-700">
                                <div class="flex-grow">
                                    <h4 class="font-semibold text-lg">Corte de Cabelo</h4>
                                    <p class="text-sm text-gray-400">Tesoura ou máquina</p>
                                </div>
                                <span class="flex-grow border-b-2 border-dotted border-zinc-600 mx-2"></span>
                                <p class="font-bold text-lg text-orange-500">R$45</p>
                            </div>
                            <!-- Price Item -->
                             <div class="flex items-center space-x-4">
                                <img src="https://images.unsplash.com/photo-1632345031435-8727f6897f53?q=80&w=1287&auto=format&fit=crop" class="w-16 h-16 rounded-full object-cover border-2 border-zinc-700">
                                <div class="flex-grow">
                                    <h4 class="font-semibold text-lg">Barba Modelada</h4>
                                    <p class="text-sm text-gray-400">Toalha quente e navalha</p>
                                </div>
                                <span class="flex-grow border-b-2 border-dotted border-zinc-600 mx-2"></span>
                                <p class="font-bold text-lg text-orange-500">R$40</p>
                            </div>
                            <!-- Price Item -->
                            <div class="flex items-center space-x-4">
                                <img src="https://images.unsplash.com/photo-1596728323641-a692411a42b1?q=80&w=1288&auto=format&fit=crop" class="w-16 h-16 rounded-full object-cover border-2 border-zinc-700">
                                <div class="flex-grow">
                                    <h4 class="font-semibold text-lg">Cabelo e Barba</h4>
                                    <p class="text-sm text-gray-400">O combo completo</p>
                                </div>
                                <span class="flex-grow border-b-2 border-dotted border-zinc-600 mx-2"></span>
                                <p class="font-bold text-lg text-orange-500">R$80</p>
                            </div>
                             <!-- Price Item -->
                            <div class="flex items-center space-x-4">
                                <img src="https://images.unsplash.com/photo-1616196652419-3a334c2642a8?q=80&w=1287&auto=format&fit=crop" class="w-16 h-16 rounded-full object-cover border-2 border-zinc-700">
                                <div class="flex-grow">
                                    <h4 class="font-semibold text-lg">Acabamento</h4>
                                    <p class="text-sm text-gray-400">Pezinho e sobrancelha</p>
                                </div>
                                <span class="flex-grow border-b-2 border-dotted border-zinc-600 mx-2"></span>
                                <p class="font-bold text-lg text-orange-500">R$25</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Página Barbeiros -->
        <div id="barbers" class="page container mx-auto px-6 py-20">
            <div class="scroll-animate">
                <h2 class="text-4xl font-brand text-center mb-12">Nossos Mestres da Navalha</h2>
                <div id="barbers-list" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="text-center text-gray-400 col-span-full">
                        <div class="loader inline-block"></div>
                        <p>Carregando barbeiros...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Página Agendamento -->
        <div id="schedule" class="page container mx-auto px-6 py-20">
            <h2 class="text-4xl font-brand text-center mb-10">Faça seu Agendamento</h2>
            <div class="max-w-4xl mx-auto bg-zinc-800 p-8 rounded-lg border border-zinc-700">
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label for="barber-select" class="block mb-2 text-sm font-medium text-gray-300">1. Escolha o Barbeiro</label>
                        <select id="barber-select" class="bg-zinc-700 border border-zinc-600 text-white text-sm rounded-lg focus:ring-orange-500 focus:border-orange-500 block w-full p-2.5">
                            <option>Selecione um barbeiro</option>
                        </select>
                    </div>
                    <div>
                        <label for="date-select" class="block mb-2 text-sm font-medium text-gray-300">2. Escolha a Data</label>
                        <input type="date" id="date-select" class="bg-zinc-700 border border-zinc-600 text-white text-sm rounded-lg focus:ring-orange-500 focus:border-orange-500 block w-full p-2.5">
                    </div>
                </div>
                <div id="time-slots-container" class="mt-8 hidden">
                    <h3 class="text-lg font-semibold mb-4 text-center">3. Escolha o Horário</h3>
                    <div id="time-slots" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-4">
                        <!-- Time slots will be injected here -->
                    </div>
                </div>
                <div id="booking-form-container" class="mt-8 hidden">
                    <h3 class="text-lg font-semibold mb-4 text-center">4. Seus Dados</h3>
                     <form id="booking-form" class="space-y-4">
                        <input type="hidden" id="selected-barber-id">
                        <input type="hidden" id="selected-barber-name">
                        <input type="hidden" id="selected-date">
                        <input type="hidden" id="selected-time">
                        <div>
                            <label for="client-name" class="block mb-2 text-sm font-medium text-gray-300">Seu Nome</label>
                            <input type="text" id="client-name" class="bg-zinc-700 border border-zinc-600 text-white text-sm rounded-lg block w-full p-2.5 focus:ring-orange-500 focus:border-orange-500" required>
                        </div>
                        <div>
                             <label for="client-phone" class="block mb-2 text-sm font-medium text-gray-300">Seu Telefone (WhatsApp)</label>
                            <input type="tel" id="client-phone" class="bg-zinc-700 border border-zinc-600 text-white text-sm rounded-lg block w-full p-2.5 focus:ring-orange-500 focus:border-orange-500" required>
                        </div>
                        <button type="submit" class="w-full bg-orange-600 text-white font-bold py-3 px-5 rounded-lg hover:bg-orange-700 transition-colors">Confirmar Agendamento</button>
                    </form>
                </div>
                 <div id="schedule-loader" class="text-center mt-8 hidden">
                    <div class="loader inline-block"></div>
                    <p>Buscando horários...</p>
                </div>
            </div>
        </div>

        <!-- Página Login -->
        <div id="login" class="page container mx-auto px-6 py-20">
             <div class="max-w-md mx-auto bg-zinc-800 p-8 rounded-lg mt-10 border border-zinc-700">
                <h2 class="text-3xl font-brand text-center mb-6">Acesso Restrito</h2>
                <form id="login-form">
                    <div class="mb-4">
                        <label for="email" class="block mb-2 text-sm font-medium text-gray-300">Email</label>
                        <input type="email" id="login-email" class="bg-zinc-700 border border-zinc-600 text-white text-sm rounded-lg block w-full p-2.5 focus:ring-orange-500 focus:border-orange-500" required>
                    </div>
                    <div class="mb-6">
                        <label for="password" class="block mb-2 text-sm font-medium text-gray-300">Senha</label>
                        <input type="password" id="login-password" class="bg-zinc-700 border border-zinc-600 text-white text-sm rounded-lg block w-full p-2.5 focus:ring-orange-500 focus:border-orange-500" required>
                    </div>
                    <button type="submit" class="w-full bg-orange-600 text-white font-bold py-2.5 px-5 rounded-lg hover:bg-orange-700 transition-colors">Entrar</button>
                    <p id="login-error" class="text-red-500 text-sm mt-4 text-center"></p>
                </form>
            </div>
        </div>

        <!-- Página Admin -->
        <div id="admin" class="page container mx-auto px-6 py-20">
            <h2 class="text-4xl font-brand text-center mb-10">Painel de Gestão</h2>
            <div id="admin-content" class="hidden">
                <!-- Conteúdo específico do Admin -->
                <div class="bg-zinc-800 p-6 rounded-lg mb-8 border border-zinc-700">
                    <h3 class="text-2xl font-bold mb-4">Gerenciar Barbeiros</h3>
                    <form id="add-barber-form" class="space-y-4">
                        <input type="text" id="barber-name" placeholder="Nome do Barbeiro" class="bg-zinc-700 border-zinc-600 rounded p-2 w-full focus:ring-orange-500 focus:border-orange-500" required>
                        <input type="text" id="barber-photo" placeholder="URL da Foto" class="bg-zinc-700 border-zinc-600 rounded p-2 w-full focus:ring-orange-500 focus:border-orange-500" required>
                        <textarea id="barber-about" placeholder="Sobre o barbeiro" class="bg-zinc-700 border-zinc-600 rounded p-2 w-full focus:ring-orange-500 focus:border-orange-500" required></textarea>
                        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition-colors">Adicionar Barbeiro</button>
                    </form>
                </div>
                <div id="admin-barbers-list" class="bg-zinc-800 p-6 rounded-lg mb-8 border border-zinc-700">
                     <h3 class="text-2xl font-bold mb-4">Barbeiros Cadastrados</h3>
                </div>
            </div>
            <div id="barber-content" class="hidden">
                 <!-- Conteúdo específico do Barbeiro -->
                 <div class="bg-zinc-800 p-6 rounded-lg border border-zinc-700">
                    <h3 class="text-2xl font-bold mb-4">Meus Agendamentos</h3>
                     <p class="text-center mb-4">Selecione uma data para ver seus horários marcados.</p>
                     <input type="date" id="barber-schedule-date" class="bg-zinc-700 border-zinc-600 rounded p-2 mx-auto block">
                     <div id="barber-appointments-list" class="mt-6">
                     </div>
                </div>
            </div>
            <div id="admin-loader" class="text-center">
                <p>Verificando permissões...</p>
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="bg-zinc-900 border-t border-zinc-800 py-12">
        <div class="container mx-auto px-6 grid md:grid-cols-3 gap-8 text-gray-400">
            <!-- Coluna 1: Sobre -->
            <div>
                <h3 class="text-xl font-brand text-orange-500 mb-4">Classic Cuts</h3>
                <p class="text-sm">A barbearia que une a tradição da navalha com a modernidade dos estilos. Um lugar para homens que valorizam qualidade e uma boa conversa.</p>
            </div>
            <!-- Coluna 2: Contato -->
            <div>
                <h4 class="font-bold text-lg text-gray-200 mb-4">Contato</h4>
                <p class="text-sm mb-2">Rua da Barbearia, 123 - Centro</p>
                <p class="text-sm">Porto Alegre, RS</p>
                <p class="text-sm mt-4 font-semibold text-white">WhatsApp: (51) 99999-8888</p>
            </div>
            <!-- Coluna 3: Redes Sociais -->
            <div>
                <h4 class="font-bold text-lg text-gray-200 mb-4">Siga-nos</h4>
                <div class="flex space-x-4">
                    <a href="#" class="hover:text-orange-500 transition-colors">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M12.315 2c2.43 0 2.784.013 3.808.06 1.064.049 1.791.218 2.427.465a4.902 4.902 0 011.772 1.153 4.902 4.902 0 011.153 1.772c.247.636.316 1.363.364 2.427.048 1.024.06 1.378.06 3.808s-.012 2.784-.06 3.808c-.049 1.064-.218 1.791-.465 2.427a4.902 4.902 0 01-1.153 1.772 4.902 4.902 0 01-1.772 1.153c-.636.247-1.363.316-2.427.364-1.024.048-1.378.06-3.808.06s-2.784-.012-3.808-.06c-1.064-.049-1.791-.218-2.427-.465a4.902 4.902 0 01-1.772-1.153 4.902 4.902 0 01-1.153-1.772c-.247-.636-.316-1.363-.364-2.427C2.013 14.784 2 14.43 2 12s.013-2.784.06-3.808c.049-1.064.218-1.791.465-2.427a4.902 4.902 0 011.153-1.772A4.902 4.902 0 015.485 3.61c.636-.247 1.363-.316 2.427-.364C8.93 2.013 9.284 2 11.715 2h.6zM12 6.848a5.152 5.152 0 100 10.304 5.152 5.152 0 000-10.304zM12 15a3 3 0 110-6 3 3 0 010 6zm6.406-11.845a1.44 1.44 0 100 2.88 1.44 1.44 0 000-2.88z" clip-rule="evenodd" /></svg>
                    </a>
                    <a href="#" class="hover:text-orange-500 transition-colors">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z" clip-rule="evenodd" /></svg>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Modal -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50">
        <div class="bg-zinc-800 rounded-lg p-8 max-w-sm mx-auto border border-zinc-700">
            <h3 id="modal-title" class="text-2xl font-bold mb-4"></h3>
            <p id="modal-message" class="text-gray-300 mb-6"></p>
            <button id="modal-close" class="w-full bg-orange-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-orange-700 transition-colors">Fechar</button>
        </div>
    </div>


    <script type="module">
        // --- Importações do Firebase ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, collection, getDocs, addDoc, doc, getDoc, 
            query, where, deleteDoc, onSnapshot 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // !!! IMPORTANTE: Cole sua configuração do Firebase aqui !!!
        const firebaseConfig = {
          apiKey: "SUA_API_KEY",
          authDomain: "SEU_AUTH_DOMAIN",
          projectId: "SEU_PROJECT_ID",
          storageBucket: "SEU_STORAGE_BUCKET",
          messagingSenderId: "SEU_MESSAGING_SENDER_ID",
          appId: "SEU_APP_ID"
        };

        const app = {
            // --- Inicialização ---
            init() {
                const firebaseApp = initializeApp(firebaseConfig);
                this.db = getFirestore(firebaseApp);
                this.auth = getAuth(firebaseApp);
                
                this.ui.init();
                this.router.init();
                this.listeners.init();
                this.authHandler.init();

                this.data.loadBarbers();
                this.setupScrollAnimations();
            },
            
            db: null,
            auth: null,
            currentUser: null,
            
            // --- Gerenciamento da UI (Interface) ---
            ui: {
                init() {
                    this.modal.init();
                    const today = new Date().toISOString().split("T")[0];
                    const dateSelect = document.getElementById('date-select');
                    const barberScheduleDate = document.getElementById('barber-schedule-date');
                    if(dateSelect) dateSelect.min = today;
                    if(barberScheduleDate) barberScheduleDate.value = today;
                },
                renderBarbers(barbers, targetId) {
                    const container = document.getElementById(targetId);
                    if (!container) return;
                    container.innerHTML = '';
                    if (barbers.length === 0) {
                        container.innerHTML = '<p class="text-center text-gray-400 col-span-full">Nenhum barbeiro encontrado.</p>';
                        return;
                    }
                    barbers.forEach(barber => {
                        const div = document.createElement('div');
                        div.className = 'bg-zinc-800 p-6 rounded-lg text-center border border-zinc-700 hover:border-orange-500 transition-colors';
                        div.innerHTML = `
                            <img src="${barber.data.imageUrl || 'https://placehold.co/200x200/18181b/f97316?text=Barbeiro'}" alt="Foto de ${barber.data.name}" class="w-32 h-32 rounded-full mx-auto mb-4 object-cover border-2 border-zinc-700">
                            <h4 class="text-xl font-bold text-orange-500">${barber.data.name}</h4>
                            <p class="text-gray-400 mt-2">${barber.data.about}</p>
                        `;
                        container.appendChild(div);
                    });
                },
                renderAdminBarbers(barbers) {
                    const container = document.getElementById('admin-barbers-list');
                    if (!container) return;
                    container.innerHTML = `<h3 class="text-2xl font-bold mb-4">Barbeiros Cadastrados</h3>`;
                     if (barbers.length === 0) {
                        container.innerHTML += '<p class="text-center text-gray-400">Nenhum barbeiro cadastrado.</p>';
                        return;
                    }
                    barbers.forEach(barber => {
                         const div = document.createElement('div');
                         div.className = 'flex justify-between items-center bg-zinc-700 p-3 rounded mb-2';
                         div.innerHTML = `
                            <span>${barber.data.name}</span>
                            <button data-id="${barber.id}" class="remove-barber-btn bg-red-600 hover:bg-red-700 text-white font-bold py-1 px-3 rounded transition-colors">Remover</button>
                         `;
                         container.appendChild(div);
                    });
                },
                populateBarberSelect(barbers) {
                    const select = document.getElementById('barber-select');
                    if (!select) return;
                    select.innerHTML = '<option value="">Selecione um barbeiro</option>';
                    barbers.forEach(barber => {
                        const option = document.createElement('option');
                        option.value = barber.id;
                        option.textContent = barber.data.name;
                        option.dataset.name = barber.data.name;
                        select.appendChild(option);
                    });
                },
                 renderTimeSlots(bookedSlots) {
                    const container = document.getElementById('time-slots');
                    if (!container) return;
                    container.innerHTML = '';
                    document.getElementById('booking-form-container').classList.add('hidden');

                    const openingHour = 9, closingHour = 18;
                    let slotsAvailable = false;

                    for (let hour = openingHour; hour < closingHour; hour++) {
                        const time = `${String(hour).padStart(2, '0')}:00`;
                        const isBooked = bookedSlots.includes(time);
                        
                        const button = document.createElement('button');
                        button.textContent = time;
                        button.dataset.time = time;
                        button.className = `p-2 rounded-lg font-semibold text-center transition-colors ${isBooked ? 'bg-zinc-600 text-gray-500 cursor-not-allowed' : 'bg-zinc-700 text-gray-200 hover:bg-orange-600 hover:text-white'}`;
                        if (isBooked) button.disabled = true;
                        else slotsAvailable = true;
                        container.appendChild(button);
                    }
                    if(!slotsAvailable){
                        container.innerHTML = '<p class="text-gray-400 col-span-full text-center">Nenhum horário disponível. Por favor, selecione outro dia.</p>';
                    }
                },
                renderBarberAppointments(appointments) {
                    const container = document.getElementById('barber-appointments-list');
                    if (!container) return;
                    container.innerHTML = '';
                    if (appointments.length === 0) {
                        container.innerHTML = '<p class="text-center text-gray-400 mt-4">Nenhum agendamento para esta data.</p>';
                        return;
                    }
                    appointments.sort((a, b) => a.time.localeCompare(b.time));
                    appointments.forEach(app => {
                        const div = document.createElement('div');
                        div.className = 'bg-zinc-700 p-4 rounded-lg mb-3';
                        div.innerHTML = `
                            <p class="font-bold text-lg text-orange-500">${app.time}</p>
                            <p>Cliente: ${app.clientName}</p>
                            <p>Contato: ${app.clientContact}</p>
                        `;
                        container.appendChild(div);
                    });
                },
                updateNav(user) {
                    const elements = ['login-nav-link', 'admin-nav-link', 'logout-nav-link', 'login-nav-link-mobile', 'admin-nav-link-mobile', 'logout-nav-link-mobile'];
                    elements.forEach(id => document.getElementById(id).classList.add('hidden'));

                    if (user) {
                        document.getElementById('admin-nav-link').classList.remove('hidden');
                        document.getElementById('logout-nav-link').classList.remove('hidden');
                        document.getElementById('admin-nav-link-mobile').classList.remove('hidden');
                        document.getElementById('logout-nav-link-mobile').classList.remove('hidden');
                    } else {
                        document.getElementById('login-nav-link').classList.remove('hidden');
                        document.getElementById('login-nav-link-mobile').classList.remove('hidden');
                    }
                },
                modal: {
                    init() {
                        document.getElementById('modal-close').addEventListener('click', () => this.hide());
                    },
                    show(title, message) {
                        document.getElementById('modal-title').textContent = title;
                        document.getElementById('modal-message').textContent = message;
                        document.getElementById('modal').classList.remove('hidden');
                    },
                    hide() {
                        document.getElementById('modal').classList.add('hidden');
                    }
                }
            },

            // --- Gerenciamento de Dados (API) ---
            data: {
                barbersCache: [],
                unsubscribeBarbers: null,
                loadBarbers() {
                    const barbersCol = collection(app.db, 'barbers');
                    this.unsubscribeBarbers = onSnapshot(barbersCol, (snapshot) => {
                        this.barbersCache = snapshot.docs.map(doc => ({ id: doc.id, data: doc.data() }));
                        app.ui.renderBarbers(this.barbersCache, 'barbers-list');
                        app.ui.renderAdminBarbers(this.barbersCache);
                        app.ui.populateBarberSelect(this.barbersCache);
                    });
                },
                async getAppointments(barberId, date) {
                     const q = query(collection(app.db, "appointments"), where("barberId", "==", barberId), where("date", "==", date));
                     const querySnapshot = await getDocs(q);
                     return querySnapshot.docs.map(doc => doc.data());
                },
                async addBarber(name, imageUrl, about) {
                    await addDoc(collection(app.db, "barbers"), { name, imageUrl, about });
                },
                async removeBarber(id) {
                    await deleteDoc(doc(app.db, "barbers", id));
                },
                async createAppointment(appointmentData) {
                    await addDoc(collection(app.db, "appointments"), appointmentData);
                }
            },

            // --- Gerenciamento de Eventos ---
            listeners: {
                init() {
                    document.getElementById('login-form').addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const email = document.getElementById('login-email').value;
                        const password = document.getElementById('login-password').value;
                        const errorP = document.getElementById('login-error');
                        errorP.textContent = '';
                        try {
                            await app.authHandler.login(email, password);
                            app.router.showPage('admin');
                        } catch (error) { errorP.textContent = "Email ou senha inválidos."; }
                    });
                    document.getElementById('add-barber-form').addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const name = document.getElementById('barber-name').value;
                        const imageUrl = document.getElementById('barber-photo').value;
                        const about = document.getElementById('barber-about').value;
                        try {
                            await app.data.addBarber(name, imageUrl, about);
                            app.ui.modal.show("Sucesso", "Barbeiro adicionado!");
                            e.target.reset();
                        } catch(error){ app.ui.modal.show("Erro", "Não foi possível adicionar o barbeiro."); }
                    });
                    document.getElementById('admin-barbers-list').addEventListener('click', (e) => {
                        if(e.target && e.target.classList.contains('remove-barber-btn')){
                            if (!confirm("Tem certeza que deseja remover este barbeiro?")) return;
                            app.data.removeBarber(e.target.dataset.id)
                                .then(() => app.ui.modal.show("Sucesso", "Barbeiro removido."))
                                .catch(() => app.ui.modal.show("Erro", "Não foi possível remover o barbeiro."));
                        }
                    });
                    const handleScheduleSelection = async () => {
                        const barberId = document.getElementById('barber-select').value;
                        const date = document.getElementById('date-select').value;
                        const timeSlotsContainer = document.getElementById('time-slots-container');
                        if (barberId && date) {
                            document.getElementById('schedule-loader').classList.remove('hidden');
                            timeSlotsContainer.classList.add('hidden');
                            const appointments = await app.data.getAppointments(barberId, date);
                            app.ui.renderTimeSlots(appointments.map(a => a.time));
                            document.getElementById('schedule-loader').classList.add('hidden');
                            timeSlotsContainer.classList.remove('hidden');
                        }
                    };
                    document.getElementById('barber-select').addEventListener('change', handleScheduleSelection);
                    document.getElementById('date-select').addEventListener('change', handleScheduleSelection);
                    document.getElementById('time-slots').addEventListener('click', (e) => {
                        if (e.target.tagName === 'BUTTON' && !e.target.disabled) {
                           document.querySelectorAll('#time-slots button.bg-orange-600').forEach(btn => btn.classList.replace('bg-orange-600','bg-zinc-700'));
                           e.target.classList.remove('bg-zinc-700');
                           e.target.classList.add('bg-orange-600');
                           
                           const barberSelect = document.getElementById('barber-select');
                           const selectedOption = barberSelect.options[barberSelect.selectedIndex];

                           document.getElementById('selected-barber-id').value = barberSelect.value;
                           document.getElementById('selected-barber-name').value = selectedOption.dataset.name;
                           document.getElementById('selected-date').value = document.getElementById('date-select').value;
                           document.getElementById('selected-time').value = e.target.dataset.time;
                           document.getElementById('booking-form-container').classList.remove('hidden');
                        }
                    });
                    document.getElementById('booking-form').addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const data = {
                            barberId: document.getElementById('selected-barber-id').value,
                            barberName: document.getElementById('selected-barber-name').value,
                            date: document.getElementById('selected-date').value,
                            time: document.getElementById('selected-time').value,
                            clientName: document.getElementById('client-name').value,
                            clientContact: document.getElementById('client-phone').value,
                        };
                        try {
                           await app.data.createAppointment(data);
                           app.ui.modal.show("Agendamento Confirmado!", `Seu horário com ${data.barberName} foi confirmado.`);
                           app.router.showPage('home');
                        } catch (error) { app.ui.modal.show("Erro", "Não foi possível agendar."); }
                    });
                    document.getElementById('barber-schedule-date').addEventListener('change', (e) => {
                       if (app.currentUser) app.authHandler.loadBarberAppointments(e.target.value);
                    });
                }
            },
            
            // --- Gerenciamento de Autenticação ---
            authHandler: {
                unsubscribeAppointments: null,
                init() {
                    onAuthStateChanged(app.auth, async (user) => {
                        document.getElementById('admin-loader').classList.add('hidden');
                        if (user) {
                            const userDoc = await this.getUserRole(user.uid);
                            app.currentUser = { ...user, role: userDoc?.role || 'barber' };
                            this.showUserDashboard();
                            this.loadBarberAppointments(document.getElementById('barber-schedule-date').value);
                        } else {
                            app.currentUser = null;
                            if (document.getElementById('admin').classList.contains('active')) app.router.showPage('home');
                        }
                        app.ui.updateNav(app.currentUser);
                    });
                },
                async login(email, password) {
                    await signInWithEmailAndPassword(app.auth, email, password);
                },
                async logout() {
                    await signOut(app.auth);
                },
                async getUserRole(uid) {
                    const docSnap = await getDoc(doc(app.db, "users", uid));
                    return docSnap.exists() ? docSnap.data() : null;
                },
                showUserDashboard() {
                    document.getElementById('admin-content').classList.add('hidden');
                    document.getElementById('barber-content').classList.add('hidden');
                    if(app.currentUser?.role === 'admin') {
                        document.getElementById('admin-content').classList.remove('hidden');
                    } else if (app.currentUser) {
                        document.getElementById('barber-content').classList.remove('hidden');
                    }
                },
                loadBarberAppointments(date) {
                    if (this.unsubscribeAppointments) this.unsubscribeAppointments();
                    if (!app.currentUser || app.currentUser.role !== 'barber') return;

                    const q = query(collection(app.db, "appointments"), where("barberId", "==", app.currentUser.uid), where("date", "==", date));
                    this.unsubscribeAppointments = onSnapshot(q, (snapshot) => {
                        const appointments = snapshot.docs.map(doc => doc.data());
                        app.ui.renderBarberAppointments(appointments);
                    });
                }
            },

            // --- Roteamento (Navegação entre páginas) ---
            router: {
                init() { this.showPage('home'); },
                showPage(pageId) {
                    document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
                    const newPage = document.getElementById(pageId);
                    if (newPage) newPage.classList.add('active');
                    window.scrollTo(0, 0);

                    // Re-ativa as animações da página que está sendo exibida
                    document.querySelectorAll(`#${pageId} .scroll-animate`).forEach(el => {
                        // Força um re-check da visibilidade ao navegar
                        const isVisible = el.getBoundingClientRect().top <= window.innerHeight && el.getBoundingClientRect().bottom >= 0;
                        if (isVisible) {
                            el.classList.add('is-visible');
                        }
                    });

                    if (pageId === 'schedule' || pageId === 'admin') {
                        const today = new Date().toISOString().split("T")[0];
                        const dateSelect = document.getElementById('date-select');
                        const barberScheduleDate = document.getElementById('barber-schedule-date');
                        if(dateSelect) dateSelect.min = today;
                        if(barberScheduleDate) barberScheduleDate.value = today;
                    }
                }
            },
            
            // --- Lógica para animação de scroll ---
            setupScrollAnimations() {
                const animatedElements = document.querySelectorAll('.scroll-animate');

                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('is-visible');
                            observer.unobserve(entry.target); // Anima apenas uma vez
                        }
                    });
                }, {
                    threshold: 0.1 // Ativa quando 10% do elemento está visível
                });

                animatedElements.forEach(element => {
                    observer.observe(element);
                });
            }
        };

        // --- Inicializa a aplicação ---
        app.init();
    </script>
</body>
</html>

